<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Books Repository</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>

<body>
  <div class="container">
    <%- include('partials/header.ejs') %>
      <section class="vh-100" style="background-color: #2779e2;">
        <div class="container h-100">
          <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-xl-6">
              <h1 class="text-white mb-4">Login </h1>
              <form action="/users/login" method="POST" class="card" id="form" style="border-radius: 15px;">
                <div class="card-body">
                  <div class="row align-items-center pt-4 pb-3">
                    <div class="col-md-3 ps-5">

                      <h6 class="mb-0">Email</h6>
                      <% if(locals.errors && locals.errors.email){ %>
                        <p class="text-danger">
                          <%= errors.email.msg %>
                        </p>
                        <% } %>
                    </div>
                    <div class="col-md-9 pe-5">
                      <input type="email" id="email" name="email" class="form-control form-control-lg"
                        placeholder="ejemplo@gmail.com" value="<%= locals.email ? `${email}` : "" %>">
                    </div>
                  </div>
                  <hr class="mx-n3">
                  <div class="row align-items-center py-3">
                    <div class="col-md-3 ps-5">
                      <h6 class="mb-0">Password</h6>
                      <% if(locals.errors && locals.errors.password){ %>
                        <p class="text-danger">
                          <%= errors.password.msg %>
                        </p>
                        <% } %>

                    </div>
                    <div class="col-md-9 pe-5">
                      <input type="password" name="password" id="password" class="form-control form-control-lg">
                    </div>
                  </div>
                  <hr class="mx-n3">
                  <div class="px-5 py-4">
                    <button type="submit" class="btn btn-primary btn-lg">Login</button>
                    <div class="errores"></div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </section>
  </div>
  <%- include('partials/footer.ejs') %>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!--     <script src="/js/loginValidations.js"  type="application/json"></script> -->


    <script>
   window.onload = function() {
  const inputEmail = document.getElementById('email');
  inputEmail.focus();
  const form = document.querySelector('#form');
  const password = document.getElementById('#password')
  form.addEventListener('submit', (e) => {
    e.preventDefault();
    let errors = [];
    console.log('hola');
    if (form.email.value == '') {
      form.email.classList.remove('.valid');
      form.email.classList.add('.errors');
      errors.push('El campo "usuario" es obligatorio.');
    } else {
      form.email.classList.remove('errors');
      form.email.classList.add('valid');
    }
    if (form.password.value == '' || form.password.value.length < 7) {
      form.password.classList.remove('.valid');
      form.password.classList.add('.errors');
      errors.push('El campo contraseña está vacío o la contraseña es incorrecta.');
    } else {
      form.password.classList.remove('errors');
      form.password.classList.add('valid');
    }
    const ul = document.querySelector('.errores');

    if (errors.length != 0) {
      ul.innerHTML = '';
      ul.classList.add('alert-warning');
      for (let i = 0; i < errors.length; i++) {
        const error = errors[i];
        ul.innerHTML += `<li>${error}</li>`;
      }
      Swal.fire(
        {
          icon: 'error',
          title: 'Hubo un error!',
          text: 'Revisa los errores!'
        }
      );
    } else {
      Swal.fire({
        title: "Buen trabajo!",
        text: "Te logueaste!",
        icon: "success"
      }).then(() => {
        form.submit();
      });
    }
  });
};
    </script>
</body>

</html>